<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= htmlspecialchars($data['article']['title'] ?? $data['title']) ?> - PrometheanLink</title>
    <link rel="stylesheet" href="/phoenix/assets/css/phoenix-core.css">
    <style>
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: var(--brand-primary);
            width: 0%;
            z-index: 1000;
            transition: width 0.1s;
        }
        .article-hero {
            position: relative;
            height: 400px;
            overflow: hidden;
        }
        .article-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .article-hero-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 60px 40px 40px;
            background: linear-gradient(transparent, rgba(10, 10, 15, 0.95));
        }
        .article-category {
            display: inline-block;
            padding: 6px 16px;
            background: var(--brand-primary);
            color: var(--brand-bg);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 15px;
        }
        .article-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            margin: 0;
            line-height: 1.2;
        }
        .article-meta {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }
        .article-layout {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 40px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }
        @media (max-width: 1200px) {
            .article-layout { grid-template-columns: 1fr; }
            .article-toc, .article-sidebar { display: none; }
        }
        .article-toc {
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        .article-toc h3 {
            font-size: 0.9rem;
            color: var(--brand-text-secondary);
            text-transform: uppercase;
            margin-bottom: 15px;
        }
        .article-toc ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .article-toc li {
            padding: 8px 0;
            border-left: 2px solid var(--brand-border);
            padding-left: 15px;
            color: var(--brand-text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .article-toc li:hover, .article-toc li.active {
            color: var(--brand-primary);
            border-color: var(--brand-primary);
        }
        .article-content {
            background: var(--brand-surface);
            border-radius: 12px;
            padding: 40px;
        }
        .article-content h2 {
            color: var(--brand-primary);
            font-size: 1.6rem;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        .article-content h2:first-child { margin-top: 0; }
        .article-content h3 {
            color: var(--brand-text);
            font-size: 1.2rem;
            margin-top: 30px;
        }
        .article-content p {
            color: var(--brand-text-secondary);
            line-height: 1.8;
            margin-bottom: 20px;
        }
        .article-content blockquote {
            border-left: 4px solid var(--brand-primary);
            padding-left: 20px;
            margin: 30px 0;
            font-style: italic;
            color: var(--brand-text);
        }
        .article-content ul, .article-content ol {
            color: var(--brand-text-secondary);
            line-height: 1.8;
            padding-left: 25px;
        }
        .article-content pre {
            background: var(--brand-bg);
            border: 1px solid var(--brand-border);
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
        }
        .article-content code {
            color: var(--brand-primary);
            font-family: 'Fira Code', monospace;
        }
        .article-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--brand-border);
        }
        .tag {
            padding: 6px 14px;
            background: var(--brand-bg);
            border: 1px solid var(--brand-border);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--brand-text-secondary);
        }
        .article-sidebar {
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        .author-card {
            background: var(--brand-surface);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        .author-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
        }
        .author-name {
            font-weight: 700;
            color: var(--brand-text);
        }
        .author-title {
            font-size: 0.85rem;
            color: var(--brand-text-secondary);
            margin-top: 5px;
        }
        .author-bio {
            font-size: 0.9rem;
            color: var(--brand-text-secondary);
            margin-top: 15px;
            line-height: 1.6;
        }
        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .share-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--brand-bg);
            border: 1px solid var(--brand-border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: var(--brand-text-secondary);
        }
        .share-btn:hover {
            background: var(--brand-primary);
            color: var(--brand-bg);
        }
        .related-section {
            margin-top: 60px;
            padding: 40px;
            background: var(--brand-surface);
        }
        .related-section h2 {
            text-align: center;
            margin-bottom: 30px;
        }
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .related-card {
            background: var(--brand-bg);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s;
            text-decoration: none;
        }
        .related-card:hover { transform: translateY(-5px); }
        .related-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .related-card-content {
            padding: 20px;
        }
        .related-card h4 {
            color: var(--brand-text);
            margin: 0 0 10px;
        }
        .related-card p {
            color: var(--brand-text-secondary);
            font-size: 0.9rem;
            margin: 0;
        }
    </style>
</head>
<body class="phoenix-page theme-cyber">
    <div class="reading-progress" id="reading-progress"></div>

    <?php $article = $data['article'] ?? []; ?>

    <?php if (!empty($data['config']['show_hero']) && !empty($article['hero_image'])): ?>
    <div class="article-hero">
        <img src="<?= htmlspecialchars($article['hero_image']) ?>" alt="">
        <div class="article-hero-overlay">
            <?php if (!empty($article['category'])): ?>
                <span class="article-category"><?= htmlspecialchars($article['category']) ?></span>
            <?php endif; ?>
            <h1 class="article-title"><?= htmlspecialchars($article['title'] ?? '') ?></h1>
            <div class="article-meta">
                <?php if (!empty($data['config']['show_date']) && !empty($article['date'])): ?>
                    <span><?= date('F j, Y', strtotime($article['date'])) ?></span>
                <?php endif; ?>
                <?php if (!empty($article['read_time'])): ?>
                    <span><?= $article['read_time'] ?> min read</span>
                <?php endif; ?>
            </div>
        </div>
    </div>
    <?php endif; ?>

    <div class="article-layout">
        <?php if (!empty($data['config']['show_toc'])): ?>
        <aside class="article-toc">
            <h3>Contents</h3>
            <ul>
                <li class="active">The Dawn of AI-Assisted Development</li>
                <li>What Makes PHOENIX Different</li>
                <li>The Technical Architecture</li>
                <li>Looking Ahead</li>
            </ul>
        </aside>
        <?php endif; ?>

        <article class="article-content">
            <?= $article['content'] ?? '' ?>

            <?php if (!empty($article['tags'])): ?>
            <div class="article-tags">
                <?php foreach ($article['tags'] as $tag): ?>
                    <span class="tag"><?= htmlspecialchars($tag) ?></span>
                <?php endforeach; ?>
            </div>
            <?php endif; ?>
        </article>

        <?php if (!empty($data['config']['show_author']) && !empty($data['author'])): ?>
        <aside class="article-sidebar">
            <div class="author-card">
                <?php if (!empty($data['author']['avatar'])): ?>
                    <img src="<?= htmlspecialchars($data['author']['avatar']) ?>" alt="" class="author-avatar">
                <?php endif; ?>
                <div class="author-name"><?= htmlspecialchars($data['author']['name'] ?? '') ?></div>
                <div class="author-title"><?= htmlspecialchars($data['author']['title'] ?? '') ?></div>
                <?php if (!empty($data['author']['bio'])): ?>
                    <p class="author-bio"><?= htmlspecialchars($data['author']['bio']) ?></p>
                <?php endif; ?>

                <?php if (!empty($data['config']['show_share'])): ?>
                <div class="share-buttons">
                    <a href="#" class="share-btn" title="Twitter">X</a>
                    <a href="#" class="share-btn" title="LinkedIn">in</a>
                    <a href="#" class="share-btn" title="Copy Link">&#128279;</a>
                </div>
                <?php endif; ?>
            </div>
        </aside>
        <?php endif; ?>
    </div>

    <?php if (!empty($data['config']['show_related']) && !empty($data['related'])): ?>
    <section class="related-section">
        <h2 class="gradient-text">Related Articles</h2>
        <div class="related-grid">
            <?php foreach ($data['related'] as $related): ?>
            <a href="<?= htmlspecialchars($related['url']) ?>" class="related-card">
                <?php if (!empty($related['image'])): ?>
                    <img src="<?= htmlspecialchars($related['image']) ?>" alt="">
                <?php endif; ?>
                <div class="related-card-content">
                    <h4><?= htmlspecialchars($related['title']) ?></h4>
                    <p><?= htmlspecialchars($related['excerpt']) ?></p>
                </div>
            </a>
            <?php endforeach; ?>
        </div>
    </section>
    <?php endif; ?>

    <script src="/phoenix/assets/js/phoenix-core.js"></script>
    <script>
        window.addEventListener('scroll', function() {
            const article = document.querySelector('.article-content');
            const progress = document.getElementById('reading-progress');
            if (!article || !progress) return;

            const rect = article.getBoundingClientRect();
            const windowHeight = window.innerHeight;
            const articleTop = rect.top + window.scrollY;
            const articleHeight = rect.height;

            const scrolled = window.scrollY - articleTop + windowHeight;
            const percentage = Math.min(100, Math.max(0, (scrolled / articleHeight) * 100));

            progress.style.width = percentage + '%';
        });
    </script>
</body>
</html>

<?php
/**
 * PHOENIX Article Template
 * Long-form content with rich media support
 */
$config = $data['config'] ?? [];
$article = $data['article'] ?? [];
$author = $data['author'] ?? [];
$related = $data['related'] ?? [];
$theme = $config['theme'] ?? 'dark';
?>
<div class="phoenix-template phoenix-article theme-<?= $theme ?>">

    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="readingProgress"></div>

    <!-- Hero Image -->
    <?php if (!empty($article['hero_image']) && ($config['show_hero'] ?? true)): ?>
    <div class="article-hero">
        <img src="<?= htmlspecialchars($article['hero_image']) ?>" alt="<?= htmlspecialchars($article['title'] ?? '') ?>">
        <div class="hero-overlay"></div>
    </div>
    <?php endif; ?>

    <div class="article-layout">
        <!-- Main Content -->
        <article class="article-content">
            <!-- Article Header -->
            <header class="article-header">
                <?php if (!empty($article['category'])): ?>
                <a href="#" class="article-category"><?= htmlspecialchars($article['category']) ?></a>
                <?php endif; ?>

                <h1 class="article-title"><?= htmlspecialchars($article['title'] ?? 'Untitled Article') ?></h1>

                <?php if (!empty($article['excerpt'])): ?>
                <p class="article-excerpt"><?= htmlspecialchars($article['excerpt']) ?></p>
                <?php endif; ?>

                <!-- Meta Info -->
                <div class="article-meta">
                    <?php if (!empty($author) && ($config['show_author'] ?? true)): ?>
                    <div class="meta-author">
                        <?php if (!empty($author['avatar'])): ?>
                        <img src="<?= htmlspecialchars($author['avatar']) ?>" alt="<?= htmlspecialchars($author['name']) ?>" class="author-avatar">
                        <?php endif; ?>
                        <div class="author-info">
                            <span class="author-name"><?= htmlspecialchars($author['name'] ?? 'Anonymous') ?></span>
                            <?php if (!empty($author['title'])): ?>
                            <span class="author-title"><?= htmlspecialchars($author['title']) ?></span>
                            <?php endif; ?>
                        </div>
                    </div>
                    <?php endif; ?>

                    <div class="meta-details">
                        <?php if (!empty($article['date']) && ($config['show_date'] ?? true)): ?>
                        <span class="meta-date">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <?= date('M j, Y', strtotime($article['date'])) ?>
                        </span>
                        <?php endif; ?>

                        <?php if (!empty($article['read_time'])): ?>
                        <span class="meta-readtime">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <?= $article['read_time'] ?> min read
                        </span>
                        <?php endif; ?>
                    </div>
                </div>
            </header>

            <!-- Article Body -->
            <div class="article-body prose">
                <?= $article['content'] ?? '<p>Article content goes here...</p>' ?>
            </div>

            <!-- Tags -->
            <?php if (!empty($article['tags'])): ?>
            <div class="article-tags">
                <?php foreach ($article['tags'] as $tag): ?>
                <a href="#" class="tag"><?= htmlspecialchars($tag) ?></a>
                <?php endforeach; ?>
            </div>
            <?php endif; ?>

            <!-- Share Buttons -->
            <?php if ($config['show_share'] ?? true): ?>
            <div class="article-share">
                <span class="share-label">Share this article</span>
                <div class="share-buttons">
                    <button class="share-btn twitter" onclick="shareTwitter()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                    </button>
                    <button class="share-btn linkedin" onclick="shareLinkedIn()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                            <rect x="2" y="9" width="4" height="12"></rect>
                            <circle cx="4" cy="4" r="2"></circle>
                        </svg>
                    </button>
                    <button class="share-btn copy" onclick="copyLink()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <?php endif; ?>

            <!-- Author Bio -->
            <?php if (!empty($author) && ($config['show_author'] ?? true)): ?>
            <div class="author-bio card">
                <?php if (!empty($author['avatar'])): ?>
                <img src="<?= htmlspecialchars($author['avatar']) ?>" alt="<?= htmlspecialchars($author['name']) ?>" class="bio-avatar">
                <?php endif; ?>
                <div class="bio-content">
                    <h4><?= htmlspecialchars($author['name'] ?? 'Anonymous') ?></h4>
                    <?php if (!empty($author['bio'])): ?>
                    <p><?= htmlspecialchars($author['bio']) ?></p>
                    <?php endif; ?>
                    <?php if (!empty($author['social'])): ?>
                    <div class="bio-social">
                        <?php foreach ($author['social'] as $platform => $url): ?>
                        <a href="<?= htmlspecialchars($url) ?>" target="_blank" rel="noopener"><?= ucfirst($platform) ?></a>
                        <?php endforeach; ?>
                    </div>
                    <?php endif; ?>
                </div>
            </div>
            <?php endif; ?>

            <!-- Comments Section -->
            <?php if ($config['show_comments'] ?? true): ?>
            <section class="article-comments" id="comments">
                <h3>Comments</h3>
                <div class="comments-placeholder">
                    <p>Comments section - integrate with your preferred system</p>
                </div>
            </section>
            <?php endif; ?>
        </article>

        <!-- Sidebar -->
        <aside class="article-sidebar">
            <!-- Table of Contents -->
            <?php if ($config['show_toc'] ?? true): ?>
            <div class="sidebar-widget toc-widget" id="tableOfContents">
                <h4>Table of Contents</h4>
                <nav class="toc-nav">
                    <!-- Generated by JavaScript -->
                </nav>
            </div>
            <?php endif; ?>

            <!-- Newsletter Signup -->
            <div class="sidebar-widget newsletter-widget card">
                <h4>Subscribe</h4>
                <p>Get the latest articles delivered to your inbox</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Your email" class="form-input">
                    <button type="submit" class="btn btn-primary">Subscribe</button>
                </form>
            </div>

            <!-- Related Posts -->
            <?php if (!empty($related) && ($config['show_related'] ?? true)): ?>
            <div class="sidebar-widget related-widget">
                <h4>Related Articles</h4>
                <div class="related-list">
                    <?php foreach (array_slice($related, 0, 4) as $post): ?>
                    <a href="<?= htmlspecialchars($post['url'] ?? '#') ?>" class="related-item">
                        <?php if (!empty($post['thumbnail'])): ?>
                        <img src="<?= htmlspecialchars($post['thumbnail']) ?>" alt="">
                        <?php endif; ?>
                        <span><?= htmlspecialchars($post['title']) ?></span>
                    </a>
                    <?php endforeach; ?>
                </div>
            </div>
            <?php endif; ?>
        </aside>
    </div>

    <!-- Related Articles Grid -->
    <?php if (!empty($related) && ($config['show_related'] ?? true)): ?>
    <section class="related-section">
        <h3>More Articles</h3>
        <div class="related-grid">
            <?php foreach (array_slice($related, 0, 3) as $post): ?>
            <article class="related-card card">
                <?php if (!empty($post['image'])): ?>
                <div class="related-image">
                    <img src="<?= htmlspecialchars($post['image']) ?>" alt="">
                </div>
                <?php endif; ?>
                <div class="related-content">
                    <h4><?= htmlspecialchars($post['title']) ?></h4>
                    <?php if (!empty($post['excerpt'])): ?>
                    <p><?= htmlspecialchars($post['excerpt']) ?></p>
                    <?php endif; ?>
                    <a href="<?= htmlspecialchars($post['url'] ?? '#') ?>" class="read-more">Read More</a>
                </div>
            </article>
            <?php endforeach; ?>
        </div>
    </section>
    <?php endif; ?>
</div>

<script>
// Reading progress
function updateReadingProgress() {
    const article = document.querySelector('.article-body');
    if (!article) return;

    const rect = article.getBoundingClientRect();
    const scrolled = Math.max(0, -rect.top);
    const total = rect.height - window.innerHeight;
    const progress = Math.min(100, (scrolled / total) * 100);

    document.getElementById('readingProgress').style.width = progress + '%';
}

window.addEventListener('scroll', updateReadingProgress);

// Table of Contents
function generateTOC() {
    const article = document.querySelector('.article-body');
    const toc = document.querySelector('.toc-nav');
    if (!article || !toc) return;

    const headings = article.querySelectorAll('h2, h3');
    let html = '';

    headings.forEach((heading, index) => {
        const id = 'heading-' + index;
        heading.id = id;
        const level = heading.tagName === 'H2' ? 'toc-h2' : 'toc-h3';
        html += `<a href="#${id}" class="${level}">${heading.textContent}</a>`;
    });

    toc.innerHTML = html;
}

document.addEventListener('DOMContentLoaded', generateTOC);

// Share functions
function shareTwitter() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(document.querySelector('.article-title')?.textContent || '');
    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
}

function shareLinkedIn() {
    const url = encodeURIComponent(window.location.href);
    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
}

function copyLink() {
    navigator.clipboard.writeText(window.location.href);
    alert('Link copied to clipboard!');
}
</script>
